name: Free Tier Optimized AI Tweet Bot v2.0

on:
  schedule:
    # 1æ—¥3å›å®Ÿè¡Œ - æ—¥æœ¬æ™‚é–“ã®æœ€é©æ™‚åˆ»
    - cron: '0 0 * * *'   # 09:00 JST (00:00 UTC)
    - cron: '0 6 * * *'   # 15:00 JST (06:00 UTC)  
    - cron: '0 12 * * *'  # 21:00 JST (12:00 UTC)
  
  workflow_dispatch:
    inputs:
      debug_mode:
        description: 'ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å®Ÿè¡Œ'
        required: false
        default: 'false'
        type: boolean
      force_post:
        description: 'åˆ¶é™ç„¡è¦–ã—ã¦æŠ•ç¨¿ãƒ†ã‚¹ãƒˆ'
        required: false
        default: 'false'
        type: boolean

jobs:
  premium_quality_tweet:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“‚ Repository Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python Environment  
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ğŸ” System Health Check
      run: |
        echo "ğŸ¥ ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­..."
        python -c "
import os
required_vars = ['TWITTER_BEARER_TOKEN', 'TWITTER_API_KEY', 'OPENAI_API_KEY']
missing = [var for var in required_vars if not os.getenv(var)]
if missing:
    print(f'âŒ ä¸è¶³ç’°å¢ƒå¤‰æ•°: {missing}')
    exit(1)
print('âœ… ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯å®Œäº†')
        "
        
    - name: ğŸ“Š Load Previous Usage Data
      continue-on-error: true
      uses: actions/cache@v3
      with:
        path: |
          usage_data.json
          content_hashes.json
          bot_execution.log
        key: bot-data-${{ github.run_number }}
        restore-keys: |
          bot-data-
          
    - name: ğŸš€ Execute Free Tier Optimized Bot
      env:
        TWITTER_BEARER_TOKEN: ${{ secrets.TWITTER_BEARER_TOKEN }}
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        DEBUG_MODE: ${{ github.event.inputs.debug_mode || 'false' }}
        FORCE_POST: ${{ github.event.inputs.force_post || 'false' }}
      run: |
        echo "ğŸ¯ ç„¡æ–™æ æœ€é©åŒ–Botã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œé–‹å§‹"
        python free_tier_bot.py
        
    - name: ğŸ“ˆ Generate Usage Report
      if: always()
      run: |
        echo "ğŸ“Š ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­..."
        python -c "
import json
from datetime import datetime

try:
    with open('usage_data.json', 'r') as f:
        data = json.load(f)
    
    print('ğŸ“Š AIè‡ªå‹•ãƒ„ã‚¤ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ  - ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆ')
    print('=' * 50)
    print(f'å®Ÿè¡Œæ™‚åˆ»: {datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")}')
    print(f'æœ¬æ—¥æŠ•ç¨¿: {data.get(\"daily_count\", 0)}/3')
    print(f'ä»ŠæœˆæŠ•ç¨¿: {data.get(\"monthly_count\", 0)}/90')
    print(f'å“è³ªæŠ•ç¨¿: {data.get(\"quality_posts\", 0)}/{data.get(\"total_posts\", 0)}')
    print(f'ç„¡æ–™æ ä½¿ç”¨ç‡: {(data.get(\"monthly_count\", 0) / 90) * 100:.1f}%')
    
    if 'post_history' in data and data['post_history']:
        latest = data['post_history'][-1]
        print(f'æœ€çµ‚æŠ•ç¨¿: {latest.get(\"timestamp\", \"N/A\")}')
        print(f'å“è³ªã‚¹ã‚³ã‚¢: {latest.get(\"quality_score\", \"N/A\")}')
        print(f'ãƒˆãƒ”ãƒƒã‚¯: {latest.get(\"topic\", \"N/A\")}')
    
    print('=' * 50)
    
except FileNotFoundError:
    print('âŒ ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
except Exception as e:
    print(f'âŒ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼: {e}')
        "
        
    - name: ğŸ“ Archive System Logs
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: bot-system-logs-${{ github.run_number }}
        path: |
          usage_data.json
          content_hashes.json
          bot_execution.log
          *.json
        retention-days: 30
        
    - name: ğŸ’¾ Save Usage Data for Next Run
      if: always()
      uses: actions/cache@v3
      with:
        path: |
          usage_data.json
          content_hashes.json
          bot_execution.log
        key: bot-data-${{ github.run_number }}
